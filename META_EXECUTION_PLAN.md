# 🎯 만파식 생태계 보완 작업 메타프롬프트 실행 계획

**작성일**: 2026년 1월 5일  
**목표**: 디자인 리뉴얼과 독립적으로 백엔드/인프라 보완 작업 수행  
**원칙**: UI/프론트엔드 수정 최소화, 백엔드 API 및 서비스 연동 중심

---

## 📋 작업 범위 정의

### ✅ 수행 가능 (백엔드/인프라)
- API Gateway 설정 수정
- 마이크로서비스 간 통신 로직
- 데이터베이스 연결 및 스키마
- 인증/보안 로직
- 서비스 간 이벤트 연동
- Docker/Kubernetes 설정
- 모니터링/로깅

### ❌ 수행 제외 (디자인 리뉴얼 충돌 방지)
- Flutter UI 컴포넌트 수정
- 화면 레이아웃 변경
- 스타일/테마 변경
- 새로운 페이지 추가
- 위젯 구조 변경

---

## 🔄 단계별 실행 프로세스

```
┌─────────────────────────────────────────────────────────────┐
│                    메타프롬프트 실행 흐름                      │
├─────────────────────────────────────────────────────────────┤
│  [Phase N 시작]                                              │
│       ↓                                                      │
│  [작업 항목 구현]                                             │
│       ↓                                                      │
│  [코드 분석 및 린트 검사]                                      │
│       ↓                                                      │
│  [검증 테스트 실행]  ──(실패)──→ [수정 및 재시도]               │
│       ↓ (성공)                                               │
│  [Phase N 완료 체크포인트]                                    │
│       ↓                                                      │
│  [Phase N+1 시작]                                            │
└─────────────────────────────────────────────────────────────┘
```

---

## 📊 Phase 별 세부 계획

### Phase 1: 인프라 설정 수정 (Critical)
**예상 소요**: 30분  
**검증 기준**: 설정 파일 문법 오류 없음

| Step | 작업 | 파일 | 검증 방법 |
|------|-----|------|----------|
| 1.1 | nginx.conf 포트 수정 | backend/gateway/nginx.conf | nginx -t 문법 검사 |
| 1.2 | docker-compose 환경변수 정리 | docker-compose.yml | yaml 문법 검사 |
| 1.3 | .env 파일 템플릿 생성 | .env.example | 파일 존재 확인 |

**완료 조건**: 모든 설정 파일 문법 검사 통과

---

### Phase 2: 서비스 간 통신 구현 (High)
**예상 소요**: 2시간  
**검증 기준**: 서비스 간 HTTP 호출 코드 존재

| Step | 작업 | 파일 | 검증 방법 |
|------|-----|------|----------|
| 2.1 | Measurement→AI 연동 | measurement-service/server.js | 함수 존재 확인 |
| 2.2 | Payment→Notification 연동 | payment-service/server.js | 함수 존재 확인 |
| 2.3 | Video→Notification 연동 | video-service/server.js | 함수 존재 확인 |
| 2.4 | 공통 서비스 호출 유틸리티 | backend/shared/service-client.js | 파일 생성 확인 |

**완료 조건**: grep으로 axios/fetch 호출 패턴 확인

---

### Phase 3: 인증 보안 강화 (High)
**예상 소요**: 1시간  
**검증 기준**: 보안 로직 코드 존재

| Step | 작업 | 파일 | 검증 방법 |
|------|-----|------|----------|
| 3.1 | Token Blacklist 구현 | auth-service/token_blacklist.go | 함수 존재 확인 |
| 3.2 | Refresh Token Rotation | auth-service/main.go | 로직 존재 확인 |
| 3.3 | JWT Secret 환경변수 분리 | auth-service/main.go | 환경변수 참조 확인 |

**완료 조건**: 보안 함수 시그니처 확인

---

### Phase 4: 데이터베이스 연동 강화 (Medium)
**예상 소요**: 1시간  
**검증 기준**: DB 연결 코드 존재

| Step | 작업 | 파일 | 검증 방법 |
|------|-----|------|----------|
| 4.1 | Measurement MongoDB 연동 | measurement-service/server.js | mongoose 연결 코드 |
| 4.2 | Redis 세션 캐시 적용 | auth-service/main.go | redis 클라이언트 코드 |
| 4.3 | 데이터베이스 헬스체크 | 각 서비스 | /health 엔드포인트에 DB 상태 포함 |

**완료 조건**: 데이터베이스 연결 코드 패턴 확인

---

### Phase 5: API 클라이언트 설정 수정 (Low - 디자인 독립)
**예상 소요**: 30분  
**검증 기준**: 설정 파일만 수정, UI 변경 없음

| Step | 작업 | 파일 | 검증 방법 |
|------|-----|------|----------|
| 5.1 | API Base URL 수정 | mobile/lib/config/api_config.dart | 포트 8080 확인 |
| 5.2 | 엔드포인트 경로 수정 | mobile/lib/features/auth/data/datasources/ | /api/v1 접두사 확인 |

**완료 조건**: 설정 값 변경만 확인 (UI 코드 변경 없음)

---

### Phase 6: 통합 검증 (Final)
**예상 소요**: 30분  
**검증 기준**: 전체 시스템 코드 일관성

| Step | 작업 | 검증 방법 |
|------|-----|----------|
| 6.1 | 포트 일관성 검사 | grep으로 포트 번호 크로스체크 |
| 6.2 | 환경변수 일관성 검사 | 모든 서비스에서 동일 환경변수명 사용 |
| 6.3 | API 경로 일관성 검사 | /api/v1 패턴 통일 확인 |
| 6.4 | 최종 보고서 생성 | 완료 상태 문서화 |

---

## 🤖 메타프롬프트 템플릿

```
## Phase {N} 실행: {Phase 이름}

### 작업 목표
{Phase의 목표 설명}

### 실행 단계
1. Step {N}.1: {작업 설명}
   - 파일: {대상 파일}
   - 수정 내용: {구체적 수정 사항}

### 검증 절차
1. 코드 분석: {검증 방법}
2. 린트 검사: read_lints 도구 실행
3. 패턴 확인: grep으로 기대 패턴 검색

### 완료 기준
- [ ] {기준 1}
- [ ] {기준 2}
- [ ] 린트 오류 없음

### 다음 단계
- 성공 시: Phase {N+1}로 이동
- 실패 시: 오류 수정 후 재검증
```

---

## 🚀 실행 시작

현재 상태에서 Phase 1부터 순차적으로 실행합니다.
각 Phase 완료 시 체크포인트를 기록하고 다음으로 진행합니다.

